<template>
    <div id="about" class="my-5">
        <div class="grid grid-cols-4 gap-5 dark:text-white">
            <div class="col-span-4 md:col-span-1 ">
                <side-list/>
            </div>
            <div class="col-span-4 md:col-span-3">
                <h5 class="text-3xl font-bold my-1">About Archive Viewer</h5>
                <p class="my-3">Twitter Archive Viewer is a complementary page to Archiver that allows offline reading of data
                    generated by <a href="https://github.com/BANKA2017/twitter-monitor/tree/node/apps/archiver" target="_blank" class="italic font-bold underline decoration-2 underline-offset-4 decoration-sky-500">Archiver()</a>.</p>
                <h5 class="text-3xl font-bold mb-1 mt-5">How to get archive files</h5>
                <p class="my-3">
                    <ul role="list" class="marker:text-sky-400 list-disc pl-5 space-y-1">
                        <li>Shared by twitter monitor official.</li>
                        <li>Generate it by yourself via <a href="https://github.com/BANKA2017/twitter-monitor/tree/node/apps/archiver" target="_blank" class="italic font-bold underline decoration-2 underline-offset-4 decoration-sky-500">Archiver()</a>.</li>
                    </ul>
                </p>
                <h5 class="text-3xl font-bold mb-1 mt-5">Create your own archive file <span class="italic underline underline-offset-4 decoration-double">and view it in this site</span></h5>
                <p >
                    <div class="border-yellow-500 border-l-4 px-2 mb-2" ><span class="font-bold">Notice:</span> Twitter's rate limit status will follow your account, once ran out of it you will unable to visit twitter until it was reset (30 mins). So we suggest you to open an incognito window to run the script below.</div>
                    <div class="border-yellow-500 border-l-4 px-2 mb-2" ><span class="font-bold">Notice2:</span> To know more issues or review the source code, please visit <a href="https://github.com/BANKA2017/twitter-monitor/tree/node/apps/archiver#known-issues" target="_blank" class="underline-offset-4 decoration-sky-500 underline">BANKA2017/twitter-monitor~/apps/archiver#known-issues</a> .</div>
                    <ul role="list" class="marker:text-sky-400 list-disc pl-5 space-y-1">
                        <li>Open <a href="https://twitter.com" class="underline-offset-4 decoration-sky-500 underline" target="_blank">twitter.com</a> in a new tab (Incognito window).</li>
                        <li>
                            Open the <a href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/Tools_and_setup/What_are_browser_developer_tools" class="underline-offset-4 decoration-sky-500 underline" target="_blank">devtools</a> and set variable in console..
                            <code class="block select-all my-2">
                                window.name="twitter";<span class="text-green-500"> //Use your screen_name to replace "twitter"</span><br />
                                window.timelineFirst=true;<span class="text-green-500"> //Use the timeline api for the **second** crawl</span>
                            </code>
                            <div tabindex="0" class="collapse border border-gray-100 bg-gray-100 dark:border-gray-900 dark:bg-gray-900 rounded-xl ">

                                <div class="collapse-title text-xl font-medium">
                                    Click and copy codes below then paste it into the <a href="https://developer.mozilla.org/en-US/docs/Learn/Common_questions/Tools_and_setup/What_are_browser_developer_tools" class="underline-offset-4 decoration-sky-500 underline" target="_blank">devtools'</a> console.
                                </div>
                                <div class="collapse-content">
                                    <code class="select-all"><pre>const e=(e="",t={})=>{const i={rest_id:()=>t?.id_str??t?.data?.user?.result?.rest_id??t?.core?.user_results?.result?.rest_id??t?.rest_id??!1,user_is_blue_verified:()=>t?.data?.user?.result?.is_blue_verified??t?.ext_is_blue_verified??t?.is_blue_verified??!1,user_info_legacy:()=>t?.data?.user?.result?.legacy??t?.legacy??t??!1,tweets_instructions:()=>t?.globalObjects?.tweets??t?.data?.user?.result?.timeline_v2?.timeline?.instructions??t?.data?.user?.result?.timeline?.timeline?.instructions??t?.data?.threaded_conversation_with_injections_v2?.instructions??t?.data?.threaded_conversation_with_injections?.instructions??t?.data?.search_by_raw_query?.search_timeline?.timeline?.instructions??t?.data?.home?.home_timeline_urt?.instructions??t?.data?.bookmark_timeline_v2?.timeline?.instructions??t?.data?.list?.tweets_timeline?.timeline?.instructions??t?.data?.list?.members_timeline?.timeline?.instructions??!1,tweets_contents:()=>t?.globalObjects?.tweets??t?.data?.user?.result?.timeline_v2?.timeline?.instructions[1]?.entries??t?.data?.user?.result?.timeline_v2?.timeline?.instructions[0]?.entries??t?.data?.user?.result?.timeline?.timeline?.instructions[1]?.entries??t?.data?.user?.result?.timeline?.timeline?.instructions[0]?.entries??t?.data?.threaded_conversation_with_injections_v2?.instructions[1]?.entries??t?.data?.threaded_conversation_with_injections_v2?.instructions[0]?.entries??t?.data?.threaded_conversation_with_injections?.instructions[1]?.entries??t?.data?.threaded_conversation_with_injections?.instructions[0]?.entries??t?.data?.search_by_raw_query?.search_timeline?.timeline?.instructions[1]?.entries??t?.data?.search_by_raw_query?.search_timeline?.timeline?.instructions[0]?.entries??t?.data?.home?.home_timeline_urt?.instructions[0]?.entries??t?.data?.bookmark_timeline_v2?.timeline?.instructions[0]?.entries??t?.data?.list?.tweets_timeline?.timeline?.instructions[0]?.entries??!1,tweets_top_content:()=>t?.data?.user?.result?.timeline_v2?.timeline?.instructions[2]?.entry??t?.data?.user?.result?.timeline?.timeline?.instructions[2]?.entry??!1,tweet_content:()=>t?.content?.itemContent?.tweet_results?.result??t?.content?.itemContent?.tweet??t?.item?.itemContent?.tweet_results?.result??t?.item?.itemContent?.tweet??!1,tweet_id:()=>t?.id_str??t?.rest_id??t?.content?.itemContent?.tweet?.rest_id??t?.content?.itemContent?.tweet_results?.result?.rest_id??t?.item?.itemContent?.tweet?.rest_id??t?.item?.itemContent?.tweet_results?.result?.rest_id??!1,tweet_uid:()=>t?.user_id_str??t?.legacy?.user_id_str??!1,tweet_conversation_id_str:()=>t?.conversation_id_str??t?.legacy?.conversation_id_str??!1,tweet_created_at:()=>t?.created_at??t?.legacy?.created_at??!1,tweet_source:()=>t?.source??t?.legacy?.source??!1,tweet_full_text:()=>t?.note_tweet?.note_tweet_results?.result?.text??t?.full_text??t?.legacy?.full_text??!1,tweet_entities:()=>t?.note_tweet?.note_tweet_results?.result?.entity_set??t?.entities??t?.legacy?.entities??!1,tweet_card_url:()=>t?.url??t?.rest_id??!1,tweet_quote_url:()=>t?.quoted_status_permalink?.url??t?.legacy?.quoted_status_permalink?.url??!1,tweet_media_path:()=>t?.legacy?.extended_entities?.media??t?.extended_entities?.media??!1,tweet_card_name:()=>t?.name??t?.legacy?.name??!1,tweet_card_path:()=>t?.card?.legacy??t?.card??!1,retweet_rest_id:()=>t?.retweeted_status_id_str??t?.legacy?.retweeted_status?.rest_id??t?.legacy?.retweeted_status_result?.result?.rest_id??!1,retweet_graphql_path:()=>t?.legacy?.retweeted_status??t?.legacy?.retweeted_status_result?.result??!1,quote_tweet_id:()=>t?.quoted_status_id_str??t?.legacy?.quoted_status_id_str??!1,quote_graphql_path:()=>t?.quoted_status_result?.result??t?.quoted_status??!1,graphql_user_result:()=>t?.core?.user_results?.result??t?.core?.user??!1};return!(null==t||!1===t||!i[e])&&i[e]()},t="SKjMMjvqRUUGgkATihdNRQ",i={spaces_2022_h2_clipping:!0,spaces_2022_h2_spaces_communities:!0,responsive_web_graphql_exclude_directive_enabled:!0,verified_phone_label_enabled:!1,creator_subscriptions_tweet_preview_api_enabled:!0,responsive_web_graphql_skip_user_profile_image_extensions_enabled:!1,tweetypie_unmention_optimization_enabled:!0,responsive_web_edit_tweet_api_enabled:!0,graphql_is_translatable_rweb_tweet_is_translatable_enabled:!0,view_counts_everywhere_api_enabled:!0,longform_notetweets_consumption_enabled:!0,tweet_awards_web_tipping_enabled:!1,freedom_of_speech_not_reach_fetch_enabled:!0,standardized_nudges_misinfo:!0,tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled:!1,responsive_web_graphql_timeline_navigation_enabled:!0,longform_notetweets_rich_text_read_enabled:!0,longform_notetweets_inline_media_enabled:!1,responsive_web_enhance_cards_enabled:!1},a="IOJ89SDQ9IrZ2t7hSD4Fdg",r={rweb_lists_timeline_redesign_enabled:!0,responsive_web_graphql_exclude_directive_enabled:!0,verified_phone_label_enabled:!1,creator_subscriptions_tweet_preview_api_enabled:!0,responsive_web_graphql_timeline_navigation_enabled:!0,responsive_web_graphql_skip_user_profile_image_extensions_enabled:!1,tweetypie_unmention_optimization_enabled:!0,responsive_web_edit_tweet_api_enabled:!0,graphql_is_translatable_rweb_tweet_is_translatable_enabled:!0,view_counts_everywhere_api_enabled:!0,longform_notetweets_consumption_enabled:!0,tweet_awards_web_tipping_enabled:!1,freedom_of_speech_not_reach_fetch_enabled:!0,standardized_nudges_misinfo:!0,tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled:!1,longform_notetweets_rich_text_read_enabled:!0,longform_notetweets_inline_media_enabled:!1,responsive_web_enhance_cards_enabled:!1},n="Pn68XRZwyV9ClrAEmK8rrQ",s={rweb_lists_timeline_redesign_enabled:!0,responsive_web_graphql_exclude_directive_enabled:!0,verified_phone_label_enabled:!1,creator_subscriptions_tweet_preview_api_enabled:!0,responsive_web_graphql_timeline_navigation_enabled:!0,responsive_web_graphql_skip_user_profile_image_extensions_enabled:!1,tweetypie_unmention_optimization_enabled:!0,responsive_web_edit_tweet_api_enabled:!0,graphql_is_translatable_rweb_tweet_is_translatable_enabled:!0,view_counts_everywhere_api_enabled:!0,longform_notetweets_consumption_enabled:!0,tweet_awards_web_tipping_enabled:!1,freedom_of_speech_not_reach_fetch_enabled:!0,standardized_nudges_misinfo:!0,tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled:!1,longform_notetweets_rich_text_read_enabled:!0,longform_notetweets_inline_media_enabled:!1,responsive_web_enhance_cards_enabled:!1},o={queryId:"NPgNFbBEhFTul68weP-tYg",operationName:"UserTweets",operationType:"query",metadata:{featureSwitches:["rweb_lists_timeline_redesign_enabled","responsive_web_graphql_exclude_directive_enabled","verified_phone_label_enabled","creator_subscriptions_tweet_preview_api_enabled","responsive_web_graphql_timeline_navigation_enabled","responsive_web_graphql_skip_user_profile_image_extensions_enabled","tweetypie_unmention_optimization_enabled","responsive_web_edit_tweet_api_enabled","graphql_is_translatable_rweb_tweet_is_translatable_enabled","view_counts_everywhere_api_enabled","longform_notetweets_consumption_enabled","tweet_awards_web_tipping_enabled","freedom_of_speech_not_reach_fetch_enabled","standardized_nudges_misinfo","tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled","longform_notetweets_rich_text_read_enabled","longform_notetweets_inline_media_enabled","responsive_web_enhance_cards_enabled"]},features:{rweb_lists_timeline_redesign_enabled:!0,responsive_web_graphql_exclude_directive_enabled:!0,verified_phone_label_enabled:!1,creator_subscriptions_tweet_preview_api_enabled:!0,responsive_web_graphql_timeline_navigation_enabled:!0,responsive_web_graphql_skip_user_profile_image_extensions_enabled:!1,tweetypie_unmention_optimization_enabled:!0,responsive_web_edit_tweet_api_enabled:!0,graphql_is_translatable_rweb_tweet_is_translatable_enabled:!0,view_counts_everywhere_api_enabled:!0,longform_notetweets_consumption_enabled:!0,tweet_awards_web_tipping_enabled:!1,freedom_of_speech_not_reach_fetch_enabled:!0,standardized_nudges_misinfo:!0,tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled:!1,longform_notetweets_rich_text_read_enabled:!0,longform_notetweets_inline_media_enabled:!1,responsive_web_enhance_cards_enabled:!1}},l={queryId:"2dNLofLWl-u8EQPURIAp9w",operationName:"UserTweetsAndReplies",operationType:"query",metadata:{featureSwitches:["rweb_lists_timeline_redesign_enabled","responsive_web_graphql_exclude_directive_enabled","verified_phone_label_enabled","creator_subscriptions_tweet_preview_api_enabled","responsive_web_graphql_timeline_navigation_enabled","responsive_web_graphql_skip_user_profile_image_extensions_enabled","tweetypie_unmention_optimization_enabled","responsive_web_edit_tweet_api_enabled","graphql_is_translatable_rweb_tweet_is_translatable_enabled","view_counts_everywhere_api_enabled","longform_notetweets_consumption_enabled","tweet_awards_web_tipping_enabled","freedom_of_speech_not_reach_fetch_enabled","standardized_nudges_misinfo","tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled","longform_notetweets_rich_text_read_enabled","longform_notetweets_inline_media_enabled","responsive_web_enhance_cards_enabled"]},features:{rweb_lists_timeline_redesign_enabled:!0,responsive_web_graphql_exclude_directive_enabled:!0,verified_phone_label_enabled:!1,creator_subscriptions_tweet_preview_api_enabled:!0,responsive_web_graphql_timeline_navigation_enabled:!0,responsive_web_graphql_skip_user_profile_image_extensions_enabled:!1,tweetypie_unmention_optimization_enabled:!0,responsive_web_edit_tweet_api_enabled:!0,graphql_is_translatable_rweb_tweet_is_translatable_enabled:!0,view_counts_everywhere_api_enabled:!0,longform_notetweets_consumption_enabled:!0,tweet_awards_web_tipping_enabled:!1,freedom_of_speech_not_reach_fetch_enabled:!0,standardized_nudges_misinfo:!0,tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled:!1,longform_notetweets_rich_text_read_enabled:!0,longform_notetweets_inline_media_enabled:!1,responsive_web_enhance_cards_enabled:!1}};var d=function e(t){function i(e,t,a){var r,n={};if(Array.isArray(e))return e.concat(t);for(r in e)n[a?r.toLowerCase():r]=e[r];for(r in t){var s=a?r.toLowerCase():r,o=t[r];n[s]=s in n&&"object"==typeof o?i(n[s],o,"headers"==s):o}return n}function a(e,a,r,n,s){var o="string"!=typeof e?(a=e).url:e,l={config:a},d=i(t,a),c={};n=n||d.data,(d.transformRequest||[]).map((function(e){n=e(n,d.headers)||n})),d.auth&&(c.authorization=d.auth),n&&"object"==typeof n&&"function"!=typeof n.append&&"function"!=typeof n.text&&(n=JSON.stringify(n),c["content-type"]="application/json");try{c[d.xsrfHeaderName]=decodeURIComponent(document.cookie.match(RegExp("(^|; )"+d.xsrfCookieName+"=([^;]*)"))[2])}catch(e){}return d.baseURL&&(o=o.replace(/^(?!.*\/\/)\/?/,d.baseURL+"/")),d.params&&(o+=(~o.indexOf("?")?"&":"?")+(d.paramsSerializer?d.paramsSerializer(d.params):new URLSearchParams(d.params))),(d.fetch||fetch)(o,{method:(r||d.method||"get").toUpperCase(),body:n,headers:i(d.headers,c,!0),credentials:d.withCredentials?"include":s}).then((function(e){for(var t in e)"function"!=typeof e[t]&&(l[t]=e[t]);return"stream"==d.responseType?(l.data=e.body,l):e[d.responseType||"text"]().then((function(e){l.data=e,l.data=JSON.parse(e)})).catch(Object).then((function(){return(d.validateStatus?d.validateStatus(e.status):e.ok)?l:Promise.reject(l)}))}))}return t=t||{},a.request=a,a.get=function(e,t){return a(e,t,"get")},a.delete=function(e,t){return a(e,t,"delete")},a.head=function(e,t){return a(e,t,"head")},a.options=function(e,t){return a(e,t,"options")},a.post=function(e,t,i){return a(e,i,"post",t)},a.put=function(e,t,i){return a(e,i,"put",t)},a.patch=function(e,t,i){return a(e,i,"patch",t)},a.all=Promise.all.bind(Promise),a.spread=function(e){return e.apply.bind(e,e)},a.CancelToken="function"==typeof AbortController?AbortController:Object,a.defaults=t,a.create=e,a}();const c="Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw",_=[c,"Bearer AAAAAAAAAAAAAAAAAAAAANRILgAAAAAAnNwIzUejRCOuH5E6I8xnZz4puTs%3D1Zv7ttfk8LF81IUq16cHjhLTvJu4FA33AGWWjCpTnA"],u=await(async()=>{if("undefined"==typeof process||process?.browser)return"undefined"!=typeof window?crypto.randomUUID().replaceAll("-",""):0;{const{webcrypto:e}=await import("crypto");return e.randomUUID().replaceAll("-","")}})(),p=(e=>{let t={timeout:3e4,headers:{"user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36"}};if(e?.headers){const i=e.headers;delete e.headers,t={...e,...t},t.headers={...i,...t.headers}}else t={...e,...t};return d.create(t)})({headers:{authorization:c,"user-agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1"}}),m=async(e="",t={},i={},a=0,r={},n=void 0)=>{if(!e)throw"tmv3: Invalid url";t.success||(t=await g(a));"object"==typeof n&&null!==n&&(n=JSON.stringify(n));let s={ct0:u};return s.gt=t.token,s={...s,...Object.fromEntries(t.cookies.map((e=>e.split("="))))},s={...s,...i},await new Promise(((i,o)=>{p(e,{headers:{authorization:_[a],"x-guest-token":t.token,"content-type":"application/json","x-csrf-token":s.ct0,cookie:Object.entries(s).map((e=>e.join("="))).join(";"),...r},method:n?"post":"get",data:n||void 0}).then((e=>{e.data||o({code:-1e3,message:"empty data"}),i(e)})).catch((e=>{e.response?429===e.response?.status?o({code:429,message:e.response.data,e:e}):o({code:e.response.data?.errors?.[0].code??-1e3,message:e.response.data?.errors?.[0].message??e.message,e:e}):o({code:-1e3,message:e.code,e:e})})).catch((e=>{o(e)}))}))},g=async(e=0)=>{let t={success:!1,token:"",code:-1e3,cookies:{},rate_limit:{UserByRestId:470,UserByScreenName:470,UserTweets:470,TweetDetail:470,AudioSpaceById:470,BroadCast:180,Search:195,Recommendation:55,Translation:180,Trending:19990,ListInfo:470,ListMember:470,ListTimeLime:470},expire:Date.now()+87e4};return await new Promise(((i,a)=>{p.post("https://api.twitter.com/1.1/guest/activate.json","",{headers:{authorization:_[e],"x-csrf-token":u,cookie:"ct0="+u}}).then((e=>{200===e.status&&e.data.guest_token&&(t.code=200,t.token=e.data.guest_token,t.success=!0,t.cookies=(e.headers instanceof Map?[...e.headers].filter((e=>"set-cookie"===e[0])).map((e=>e[1]))??[]:e.headers?.["set-cookie"]??[]).map((e=>e.split(";")[0]))),i(t)})).catch((e=>{t.token=e.message,a(t)}))}))},h=(e={},t={})=>Object.fromEntries(Object.entries(t).map((t=>(void 0!==e[t[0]]&&(t[1]=e[t[0]]),t)))),w=async(e={queryString:"",cursor:"",guest_token:{},count:!1,online:!1,graphqlMode:!0,searchMode:!1,withReply:!1,cookie:{},authorization:1},t={})=>{let{queryString:i,cursor:n,guest_token:s,count:d,online:c,graphqlMode:_,searchMode:u,withReply:p,cookie:b,authorization:f}=h(e,{queryString:"",cursor:"",guest_token:{},count:!1,online:!1,graphqlMode:!0,searchMode:!1,withReply:!1,cookie:{},authorization:1});if(d=d||(n?499:c?40:_?499:999),s.success||(s=await g(f)),Array.isArray(i))return await Promise.allSettled(i.map((e=>w({queryString:e,cursor:n,guest_token:s,count:d,online:c,graphqlMode:_,searchMode:u,cookie:b,authorization:f}))));if(_&&!u){let e={userId:i,count:d,withTweetQuoteCount:!0,withQuickPromoteEligibilityTweetFields:!0,withSuperFollowsUserFields:!0,withSuperFollowsTweetFields:!0,withDownvotePerspective:!1,withReactionsMetadata:!1,includePromotedContent:!0,withReactionsPerspective:!1,withUserResults:!1,withVoice:!0,withNonLegacyCard:!0,withV2Timeline:!0};return n&&(e.cursor=n),await new Promise(((t,i)=>{m("https://twitter.com/i/api/graphql/"+(p?l.queryId+"/UserTweetsAndReplies?":o.queryId+"/UserTweets?")+new URLSearchParams({variables:JSON.stringify(e),features:JSON.stringify(p?l.features:o.features)}).toString(),s,b,f).then((e=>{t(e)})).catch((e=>{i(e)}))}))}if(u){i.trim();let e={rawQuery:i.trim(),count:d,product:"Latest",withDownvotePerspective:!1,withReactionsMetadata:!1,withReactionsPerspective:!1};return n&&(e.cursor=n),await new Promise(((t,i)=>{m("https://api.twitter.com/graphql/"+a+"/SearchTimeline?"+new URLSearchParams({variables:JSON.stringify(e),features:JSON.stringify(r)}).toString(),s,b,f).then((e=>{t(e)})).catch((e=>{i(e)}))}))}return await new Promise(((e,t)=>{m(`https://api.twitter.com/2/timeline/profile/${i}.json?include_profile_interstitial_type=1&include_blocking=1&include_blocked_by=1&include_followed_by=1&include_want_retweets=1&include_mute_edge=1&include_can_dm=1&include_can_media_tag=1&skip_status=1&cards_platform=Web-12&include_cards=1&include_composer_source=true&include_ext_alt_text=true&include_reply_count=1&tweet_mode=extended&include_entities=true&include_user_entities=true&include_ext_media_color=true&include_ext_media_availability=true&send_error_codes=true&simple_quoted_tweets=true&ext=mediaStats%2CcameraMoment&count=`+(n?"&cursor="+encodeURIComponent(n):""),s,b,f).then((t=>{e(t)})).catch((e=>{t(e)}))}))},b=async(e={tweet_id:"",guest_token:{},graphqlMode:!0,authorization:1,cursor:"",cookie:{}},t={})=>{let{tweet_id:i,guest_token:a,graphqlMode:r,authorization:o,cursor:l,cookie:d}=h(e,{tweet_id:"",guest_token:{},graphqlMode:!0,authorization:1,cursor:"",cookie:{}});if(a.success||(a=await g(o)),Array.isArray(i))return await Promise.allSettled(i.map((e=>b({tweet_id:e,guest_token:a,graphqlMode:r,authorization:o,cursor:l,cookie:d}))));if(r){let e={focalTweetId:i,with_rux_injections:!1,includePromotedContent:!0,withCommunity:!0,withQuickPromoteEligibilityTweetFields:!0,withBirdwatchNotes:!0,withSuperFollowsUserFields:!0,withDownvotePerspective:!1,withReactionsMetadata:!1,withReactionsPerspective:!1,withSuperFollowsTweetFields:!0,withVoice:!0,withV2Timeline:!0};return l&&(e.cursor=l),await new Promise(((t,i)=>{m("https://api.twitter.com/graphql/"+n+"/TweetDetail?"+new URLSearchParams({variables:JSON.stringify(e),features:JSON.stringify(s)}).toString(),a,d,o).then((e=>{t(e)})).catch((e=>{i(e)}))}))}return await new Promise(((e,t)=>{m("https://api.twitter.com/2/timeline/conversation/"+i+".json?include_profile_interstitial_type=1&include_blocking=1&include_blocked_by=1&include_followed_by=1&include_want_retweets=1&include_mute_edge=1&include_can_dm=1&include_can_media_tag=1&skip_status=1&cards_platform=Web-12&include_cards=1&include_composer_source=true&include_ext_alt_text=true&include_reply_count=1&tweet_mode=extended&include_entities=true&include_user_entities=true&include_ext_media_color=true&include_ext_media_availability=true&send_error_codes=true&simple_quoted_tweets=true&count=1&ext=mediaStats%2CcameraMoment",a,d,o).then((t=>{e(t)})).catch((e=>{t(e)}))}))},f=async(e={id:"",guest_token:{},cookie:{},authorization:1},a={})=>{let{id:r,guest_token:n,cookie:s,authorization:o}=h(e,{id:"",guest_token:{},cookie:{},authorization:1});if(n.success||(n=await g(o)),Array.isArray(r))return await Promise.allSettled(r.map((e=>f({id:e,guest_token:n,cookie:s,authorization:o}))));const l={id:r,isMetatagsQuery:!0,withSuperFollowsUserFields:!0,withDownvotePerspective:!1,withReactionsMetadata:!1,withReactionsPerspective:!1,withSuperFollowsTweetFields:!0,withReplays:!0};return await new Promise(((e,a)=>{m("https://api.twitter.com/graphql/"+t+"/AudioSpaceById?"+new URLSearchParams({variables:JSON.stringify(l),features:JSON.stringify(i)}).toString(),n,s,o).then((t=>{e(t)})).catch((e=>{a(e)}))}))},y=async(e={id:"",guest_token:{},cookie:{},authorization:1},t={})=>{let{id:i,guest_token:a,cookie:r,authorization:n}=h(e,{id:"",guest_token:{},cookie:{},authorization:1});return a.success||(a=await g(n)),Array.isArray(i)?await Promise.allSettled(i.map((e=>y({id:e,guest_token:a,cookie:r,authorization:n})))):await new Promise(((e,t)=>{m(`https://api.twitter.com/1.1/broadcasts/show.json?ids=${i}&include_events=true`,a,r,n).then((t=>{e(t)})).catch((e=>{t(e)}))}))},v=async(e={media_key:"",guest_token:{},cookie:{},authorization:1},t={})=>{let{media_key:i,guest_token:a,cookie:r,authorization:n}=h(e,{media_key:"",guest_token:{},cookie:{},authorization:1});return a.success||(a=await g(n)),Array.isArray(i)?await Promise.allSettled(id.map((e=>v({id:e,guest_token:a,cookie:r,authorization:n})))):await new Promise(((e,t)=>{m(`https://api.twitter.com/1.1/live_video_stream/status/${i}?client=web&use_syndication_guest_id=false&cookie_set_host=twitter.com`,a,r,n).then((t=>{e(t)})).catch((e=>{t(e)}))}))},x=async(t={tweet_id:"",guest_token:{},cookie:{},authorization:1},i={})=>{let{tweet_id:a,guest_token:r,cookie:n,authorization:s}=h(t,{tweet_id:"",guest_token:{},cookie:{},authorization:1});if(!a)return{code:403,message:"Invalid tweet id",data:[]};let o=await b({tweet_id:a,guest_token:r,graphqlMode:!0,cookie:n,authorization:s});if(o=e("tweets_contents",o.data),!o)return{code:404,message:"No tweets",data:[]};const l=e("tweet_content",o.filter((e=>e.entryId==="tweet-"+a))[0]??[]),d=e("tweet_card_path",l);if(d&&String(e("tweet_card_name",d)).startsWith("poll")){const e=[],t=Object.fromEntries(d.binding_values.map((e=>[e.key,e.value])));for(let i=1;i&lt;=4&&t["choice"+i+"_count"];i++)e.push(t["choice"+i+"_count"].string_value);return{code:200,message:"Success",data:e}}return{code:403,message:"Invalid card type",data:[]}};const T=e=>{let t={dirname:"",basename:"",filename:"",pathtype:0,extension:"",size:"normal",firstpath:""};const i=!/^[\w]+:\/\//g.test(e),a=new URL((i?"http://":"")+e);let r=a.pathname.split("/");a.base=r.pop(),a.dir=(i?"":a.protocol+"//")+(a.username&&a.password?[a.username,a.password].join(":")+"@":"")+a.host+r.join("/")+"/";const n=a.base.split(".");if(a.ext=n.length>1?n.pop():"",a.name=n.join("."),t.dirname=a.dir,""===a.ext)try{t.pathtype=1,t.extension=a.searchParams.get("format")??"jpg",t.size=a.searchParams.get("name")??"normal",t.filename=a.base}catch(e){}else a.ext.includes(":")?([t.extension,t.size]=a.ext.split(":"),a.base=a.base.replaceAll(`:${t.size}`,""),t.pathtype=2,t.filename=a.name):(/^(?:http(?:s|):\/\/|)[^\/]+\.pscp\.tv\//g.test(t.dirname)&&(t.pathtype=3),t.filename=a.name,t.extension=a.ext);return t.basename=a.base,t.firstpath=a.host,t},E=(e="",t="description")=>{let i=/&lt;a href="([^"]+)"(?: id="[^"]"+|)(?: target="_blank"|)[^>]+>([^&lt;]+)&lt;\/a>|(?:\s|\p{P}|\p{S}|^)(#|\$)((?:[^\s\p{P}\p{S}]|_)+)|(?:\s|\p{P}|\p{S}|^)@([\w]+)/gmu;const a=(e=e.replaceAll(/(?:|\n)(?:&lt;br>|&lt;br \/>)(?:|\n)/gm,"\n")).replaceAll(/&lt;a[^>]+>([^&lt;]+)&lt;\/a>/gm,"$1");let r;const n=[];let s=0;for(;null!==(r=i.exec(e));)if(r.index===i.lastIndex&&i.lastIndex++,void 0===r[2]&&void 0!==r[4]){const e=r[3],t=r[4],i=[...[...a].slice(s).join("").split(`${e}${t}`)[0]].length+s;s=i+[...r[4]].length+1,n.push({expanded_url:"",indices_end:s,indices_start:i,text:t,type:"#"===e?"hashtag":"symbol"})}else if(void 0===r[2]&&void 0!==r[5]){const e=r[5],t=[...[...a].slice(s).join("").split(`@${e}`)[0]].length+s;s=t+[...r[5]].length+1,n.push({expanded_url:"",indices_end:s,indices_start:t,text:`@${e}`,type:"user_mention"})}else{const e=[...[...a].slice(s).join("").split(r[2])[0]].length+s;s=e+[...r[2]].length;let t=r[1].replaceAll("//http","http").startsWith("https://twitter.com/")&&r[2].startsWith("@")?"user_mention":r[2].startsWith("#")?"hashtag":r[2].startsWith("$")?"symbol":"url";n.push({expanded_url:r[1].replaceAll("//http","http"),indices_end:s,indices_start:e,text:["hashtag","symbol"].includes(t)?r[2].slice(1):r[2],type:t})}return{originText:a,entities:n}},A=["summary","summary_large_image","promo_website","audio","player","periscope_broadcast","broadcast","promo_video_website","promo_image_convo","promo_video_convo","direct_store_link_app","promo_image_app","app","live_event","moment","poll2choice_text_only","poll3choice_text_only","poll4choice_text_only","poll2choice_image","poll3choice_image","poll4choice_image","unified_card","appplayer","audiospace"],k=["business","government"],S=(t,i={})=>{let a={uid:0,name:"",display_name:"",header:"",banner:"",following:0,followers:0,media_count:0,created_at:0,description:"",description_origin:"",verified:"",top:"0",statuses_count:0},r={uid:0,name:"",display_name:"",following:0,followers:0,statuses_count:0,timestamp:Math.floor(new Date/1e3)},n=!1;const s=e("rest_id",t)||0,o=e("user_info_legacy",t);o.profile_banner_url?(a.banner=o.profile_banner_url.replaceAll(/.*\/([\d]+)$/gm,"$1"),n=!0):a.banner=0,a.uid=r.uid=s,a.name=r.name=o.screen_name,a.display_name=r.display_name=o.name,o.profile_image_url_https&&(a.header=o.profile_image_url_https.replaceAll(/\/([0-9]+|default_profile_images)\/([\w\-]+)_normal.([\w]+)$/gm,"/$1/$2.$3")),a.following=r.following=o.friends_count,a.followers=r.followers=o.followers_count,a.media_count=r.media_count=o.media_count,a.statuses_count=r.statuses_count=o.statuses_count,a.created_at=Math.floor(Date.parse(o.created_at)/1e3),a.verified=((e=!1,t=!1,i)=>{let a=0;return e&&(a|=128),t&&(a|=64),i&&(a|=k.indexOf(String(i).toLocaleLowerCase())+1),a>255||a&lt;0?0:a})(o.verified,e("user_is_blue_verified",t),o.ext_verified_type||o.verified_type||!1),a.top=o.pinned_tweet_ids_str?.length?o.pinned_tweet_ids_str[0]:"0";let l=o.description;if(a.description_origin=l,o.entities?.description.urls)for(const e of o.entities.description.urls)l=l.replaceAll(e.url,'&lt;a href="'+e.expanded_url+'" target="_blank">'+e.display_url+"&lt;/a>");return a.description=l,a=Object.assign(a,i),{GeneralAccountData:a,...a,monitorDataInfo:r,update:n}};var O=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var i=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(i,1),i>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var i=t.length,a=0;a&lt;i;++a)t[a].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),n=t.length,s=0;s&lt;n;++s)t[s].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",(function(t){e.push(t)}))},e}();function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t&lt;arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},I.apply(this,arguments)}var R,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};R="undefined"!=typeof window?window:void 0!==D?D:"undefined"!=typeof self?self:{};var q,j=(q=R)&&q.__esModule&&Object.prototype.hasOwnProperty.call(q,"default")?q.default:q;function N(e){for(var t,i=(t=e,j.atob?j.atob(t):Buffer.from(t,"base64").toString("binary")),a=new Uint8Array(i.length),r=0;r&lt;i.length;r++)a[r]=i.charCodeAt(r);return a}
/*! @name m3u8-parser @version 6.2.0 @license Apache-2.0 */class P extends O{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const $=String.fromCharCode(9),C=function(e){const t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),i={};return t[1]&&(i.length=parseInt(t[1],10)),t[2]&&(i.offset=parseInt(t[2],10)),i},M=function(e){const t={};if(!e)return t;const i=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))'));let a,r=i.length;for(;r--;)""!==i[r]&&(a=/([^=]*)=(.*)/.exec(i[r]).slice(1),a[0]=a[0].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^\s+|\s+$/g,""),a[1]=a[1].replace(/^['"](.*)['"]$/g,"$1"),t[a[0]]=a[1]);return t};class U extends O{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,i;if(0===(e=e.trim()).length)return;if("#"!==e[0])return void this.trigger("data",{type:"uri",uri:e});this.tagMappers.reduce(((t,i)=>{const a=i(e);return a===e?t:t.concat([a])}),[e]).forEach((e=>{for(let t=0;t&lt;this.customParsers.length;t++)if(this.customParsers[t].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e),t)this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(e),t)return i={type:"tag",tagType:"inf"},t[1]&&(i.duration=parseFloat(t[1])),t[2]&&(i.title=t[2]),void this.trigger("data",i);if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(e),t)return i={type:"tag",tagType:"targetduration"},t[1]&&(i.duration=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(e),t)return i={type:"tag",tagType:"version"},t[1]&&(i.version=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return i={type:"tag",tagType:"media-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return i={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(i.number=parseInt(t[1],10)),void this.trigger("data",i);if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(e),t)return i={type:"tag",tagType:"playlist-type"},t[1]&&(i.playlistType=t[1]),void this.trigger("data",i);if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(e),t)return i=I(C(t[1]),{type:"tag",tagType:"byterange"}),void this.trigger("data",i);if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(e),t)return i={type:"tag",tagType:"allow-cache"},t[1]&&(i.allowed=!/NO/.test(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-MAP:(.*)$/.exec(e),t){if(i={type:"tag",tagType:"map"},t[1]){const e=M(t[1]);e.URI&&(i.uri=e.URI),e.BYTERANGE&&(i.byterange=C(e.BYTERANGE))}this.trigger("data",i)}else if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(e),t){if(i={type:"tag",tagType:"stream-inf"},t[1]){if(i.attributes=M(t[1]),i.attributes.RESOLUTION){const e=i.attributes.RESOLUTION.split("x"),t={};e[0]&&(t.width=parseInt(e[0],10)),e[1]&&(t.height=parseInt(e[1],10)),i.attributes.RESOLUTION=t}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["FRAME-RATE"]&&(i.attributes["FRAME-RATE"]=parseFloat(i.attributes["FRAME-RATE"])),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}this.trigger("data",i)}else{if(t=/^#EXT-X-MEDIA:(.*)$/.exec(e),t)return i={type:"tag",tagType:"media"},t[1]&&(i.attributes=M(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-ENDLIST/.exec(e),t)this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(e),t)return i={type:"tag",tagType:"program-date-time"},t[1]&&(i.dateTimeString=t[1],i.dateTimeObject=new Date(t[1])),void this.trigger("data",i);if(t=/^#EXT-X-KEY:(.*)$/.exec(e),t)return i={type:"tag",tagType:"key"},t[1]&&(i.attributes=M(t[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),void this.trigger("data",i);if(t=/^#EXT-X-START:(.*)$/.exec(e),t)return i={type:"tag",tagType:"start"},t[1]&&(i.attributes=M(t[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),void this.trigger("data",i);if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(e),t)return i={type:"tag",tagType:"cue-out-cont"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(e),t)return i={type:"tag",tagType:"cue-out"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-CUE-IN:(.*)?$/.exec(e),t)return i={type:"tag",tagType:"cue-in"},t[1]?i.data=t[1]:i.data="",void this.trigger("data",i);if(t=/^#EXT-X-SKIP:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"skip"},i.attributes=M(t[1]),i.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(i.attributes["SKIPPED-SEGMENTS"]=parseInt(i.attributes["SKIPPED-SEGMENTS"],10)),i.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(i.attributes["RECENTLY-REMOVED-DATERANGES"]=i.attributes["RECENTLY-REMOVED-DATERANGES"].split($)),void this.trigger("data",i);if(t=/^#EXT-X-PART:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"part"},i.attributes=M(t[1]),["DURATION"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))})),["INDEPENDENT","GAP"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=/YES/.test(i.attributes[e]))})),i.attributes.hasOwnProperty("BYTERANGE")&&(i.attributes.byterange=C(i.attributes.BYTERANGE)),void this.trigger("data",i);if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"server-control"},i.attributes=M(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=/YES/.test(i.attributes[e]))})),void this.trigger("data",i);if(t=/^#EXT-X-PART-INF:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"part-inf"},i.attributes=M(t[1]),["PART-TARGET"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))})),void this.trigger("data",i);if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"preload-hint"},i.attributes=M(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(e){if(i.attributes.hasOwnProperty(e)){i.attributes[e]=parseInt(i.attributes[e],10);const t="BYTERANGE-LENGTH"===e?"length":"offset";i.attributes.byterange=i.attributes.byterange||{},i.attributes.byterange[t]=i.attributes[e],delete i.attributes[e]}})),void this.trigger("data",i);if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e),t&&t[1])return i={type:"tag",tagType:"rendition-report"},i.attributes=M(t[1]),["LAST-MSN","LAST-PART"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseInt(i.attributes[e],10))})),void this.trigger("data",i);if(t=/^#EXT-X-DATERANGE:(.*)$/.exec(e),t&&t[1]){i={type:"tag",tagType:"daterange"},i.attributes=M(t[1]),["ID","CLASS"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=String(i.attributes[e]))})),["START-DATE","END-DATE"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=new Date(i.attributes[e]))})),["DURATION","PLANNED-DURATION"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=parseFloat(i.attributes[e]))})),["END-ON-NEXT"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=/YES/i.test(i.attributes[e]))})),["SCTE35-CMD"," SCTE35-OUT","SCTE35-IN"].forEach((function(e){i.attributes.hasOwnProperty(e)&&(i.attributes[e]=i.attributes[e].toString(16))}));const e=/^X-([A-Z]+-)+[A-Z]+$/;for(const t in i.attributes){if(!e.test(t))continue;const a=/[0-9A-Fa-f]{6}/g.test(i.attributes[t]),r=/^\d+(\.\d+)?$/.test(i.attributes[t]);i.attributes[t]=a?i.attributes[t].toString(16):r?parseFloat(i.attributes[t]):String(i.attributes[t])}this.trigger("data",i)}else t=/^#EXT-X-INDEPENDENT-SEGMENTS/.exec(e),t?this.trigger("data",{type:"tag",tagType:"independent-segments"}):this.trigger("data",{type:"tag",data:e.slice(4)})}}}else this.trigger("data",{type:"comment",text:e.slice(1)})}))}addParser({expression:e,customType:t,dataParser:i,segment:a}){"function"!=typeof i&&(i=e=>e),this.customParsers.push((r=>{if(e.exec(r))return this.trigger("data",{type:"custom",data:i(r),customType:t,segment:a}),!0}))}addTagMapper({expression:e,map:t}){this.tagMappers.push((i=>e.test(i)?t(i):i))}}const L=function(e){const t={};return Object.keys(e).forEach((function(i){var a;t[(a=i,a.toLowerCase().replace(/-(\w)/g,(e=>e[1].toUpperCase())))]=e[i]})),t},X=function(e){const{serverControl:t,targetDuration:i,partTargetDuration:a}=e;if(!t)return;const r="#EXT-X-SERVER-CONTROL",n="holdBack",s="partHoldBack",o=i&&3*i,l=a&&2*a;i&&!t.hasOwnProperty(n)&&(t[n]=o,this.trigger("info",{message:`${r} defaulting HOLD-BACK to targetDuration * 3 (${o}).`})),o&&t[n]&lt;o&&(this.trigger("warn",{message:`${r} clamping HOLD-BACK (${t[n]}) to targetDuration * 3 (${o})`}),t[n]=o),a&&!t.hasOwnProperty(s)&&(t[s]=3*a,this.trigger("info",{message:`${r} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${t[s]}).`})),a&&t[s]&lt;l&&(this.trigger("warn",{message:`${r} clamping PART-HOLD-BACK (${t[s]}) to partTargetDuration * 2 (${l}).`}),t[s]=l)};class G extends O{constructor(){super(),this.lineStream=new P,this.parseStream=new U,this.lineStream.pipe(this.parseStream);const e=this,t=[];let i,a,r={},n=!1;const s=function(){},o={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};let l=0;this.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};let d=0,c=0;const _={};this.on("end",(()=>{r.uri||!r.parts&&!r.preloadHints||(!r.map&&i&&(r.map=i),!r.key&&a&&(r.key=a),r.timeline||"number"!=typeof l||(r.timeline=l),this.manifest.preloadSegment=r)})),this.parseStream.on("data",(function(u){let p,m;({tag(){({version(){u.version&&(this.manifest.version=u.version)},"allow-cache"(){this.manifest.allowCache=u.allowed,"allowed"in u||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const e={};"length"in u&&(r.byterange=e,e.length=u.length,"offset"in u||(u.offset=d)),"offset"in u&&(r.byterange=e,e.offset=u.offset),d=e.offset+e.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),u.duration>0&&(r.duration=u.duration),0===u.duration&&(r.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=t},key(){if(u.attributes)if("NONE"!==u.attributes.METHOD)if(u.attributes.URI){if("com.apple.streamingkeydelivery"===u.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:u.attributes});if("com.microsoft.playready"===u.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:u.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===u.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(u.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===u.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==u.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):u.attributes.KEYID&&"0x"===u.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:u.attributes.KEYFORMAT,keyId:u.attributes.KEYID.substring(2)},pssh:N(u.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}u.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),a={method:u.attributes.METHOD||"AES-128",uri:u.attributes.URI},void 0!==u.attributes.IV&&(a.iv=u.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else a=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence"(){isFinite(u.number)?this.manifest.mediaSequence=u.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+u.number})},"discontinuity-sequence"(){isFinite(u.number)?(this.manifest.discontinuitySequence=u.number,l=u.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+u.number})},"playlist-type"(){/VOD|EVENT/.test(u.playlistType)?this.manifest.playlistType=u.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+u.playlist})},map(){i={},u.uri&&(i.uri=u.uri),u.byterange&&(i.byterange=u.byterange),a&&(i.key=a)},"stream-inf"(){this.manifest.playlists=t,this.manifest.mediaGroups=this.manifest.mediaGroups||o,u.attributes?(r.attributes||(r.attributes={}),I(r.attributes,u.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||o,!(u.attributes&&u.attributes.TYPE&&u.attributes["GROUP-ID"]&&u.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});const e=this.manifest.mediaGroups[u.attributes.TYPE];e[u.attributes["GROUP-ID"]]=e[u.attributes["GROUP-ID"]]||{},p=e[u.attributes["GROUP-ID"]],m={default:/yes/i.test(u.attributes.DEFAULT)},m.default?m.autoselect=!0:m.autoselect=/yes/i.test(u.attributes.AUTOSELECT),u.attributes.LANGUAGE&&(m.language=u.attributes.LANGUAGE),u.attributes.URI&&(m.uri=u.attributes.URI),u.attributes["INSTREAM-ID"]&&(m.instreamId=u.attributes["INSTREAM-ID"]),u.attributes.CHARACTERISTICS&&(m.characteristics=u.attributes.CHARACTERISTICS),u.attributes.FORCED&&(m.forced=/yes/i.test(u.attributes.FORCED)),p[u.attributes.NAME]=m},discontinuity(){l+=1,r.discontinuity=!0,this.manifest.discontinuityStarts.push(t.length)},"program-date-time"(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=u.dateTimeString,this.manifest.dateTimeObject=u.dateTimeObject),r.dateTimeString=u.dateTimeString,r.dateTimeObject=u.dateTimeObject},targetduration(){!isFinite(u.duration)||u.duration&lt;0?this.trigger("warn",{message:"ignoring invalid target duration: "+u.duration}):(this.manifest.targetDuration=u.duration,X.call(this,this.manifest))},start(){u.attributes&&!isNaN(u.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:u.attributes["TIME-OFFSET"],precise:u.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out"(){r.cueOut=u.data},"cue-out-cont"(){r.cueOutCont=u.data},"cue-in"(){r.cueIn=u.data},skip(){this.manifest.skip=L(u.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",u.attributes,["SKIPPED-SEGMENTS"])},part(){n=!0;const e=this.manifest.segments.length,t=L(u.attributes);r.parts=r.parts||[],r.parts.push(t),t.byterange&&(t.byterange.hasOwnProperty("offset")||(t.byterange.offset=c),c=t.byterange.offset+t.byterange.length);const i=r.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${i} for segment #${e}`,u.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(((e,t)=>{e.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${t} lacks required attribute(s): LAST-PART`})}))},"server-control"(){const e=this.manifest.serverControl=L(u.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),X.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const e=this.manifest.segments.length,t=L(u.attributes),i=t.type&&"PART"===t.type;r.preloadHints=r.preloadHints||[],r.preloadHints.push(t),t.byterange&&(t.byterange.hasOwnProperty("offset")||(t.byterange.offset=i?c:0,i&&(c=t.byterange.offset+t.byterange.length)));const a=r.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${a} for segment #${e}`,u.attributes,["TYPE","URI"]),t.type)for(let i=0;i&lt;r.preloadHints.length-1;i++){const n=r.preloadHints[i];n.type&&(n.type===t.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${a} for segment #${e} has the same TYPE ${t.type} as preload hint #${i}`}))}},"rendition-report"(){const e=L(u.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);const t=this.manifest.renditionReports.length-1,i=["LAST-MSN","URI"];n&&i.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${t}`,u.attributes,i)},"part-inf"(){this.manifest.partInf=L(u.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",u.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),X.call(this,this.manifest)},daterange(){this.manifest.daterange=this.manifest.daterange||[],this.manifest.daterange.push(L(u.attributes));const e=this.manifest.daterange.length-1;this.warnOnMissingAttributes_(`#EXT-X-DATERANGE #${e}`,u.attributes,["ID","START-DATE"]);const t=this.manifest.daterange[e];t.endDate&&t.startDate&&new Date(t.endDate)&lt;new Date(t.startDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE END-DATE must be equal to or later than the value of the START-DATE"}),t.duration&&t.duration&lt;0&&this.trigger("warn",{message:"EXT-X-DATERANGE DURATION must not be negative"}),t.plannedDuration&&t.plannedDuration&lt;0&&this.trigger("warn",{message:"EXT-X-DATERANGE PLANNED-DURATION must not be negative"});const i=!!t.endOnNext;if(i&&!t.class&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must have a CLASS attribute"}),i&&(t.duration||t.endDate)&&this.trigger("warn",{message:"EXT-X-DATERANGE with an END-ON-NEXT=YES attribute must not contain DURATION or END-DATE attributes"}),t.duration&&t.endDate){const i=t.startDate,a=i.setSeconds(i.getSeconds()+t.duration);this.manifest.daterange[e].endDate=new Date(a)}if(t&&!this.manifest.dateTimeString&&this.trigger("warn",{message:"A playlist with EXT-X-DATERANGE tag must contain atleast one EXT-X-PROGRAM-DATE-TIME tag"}),_[t.id]){for(const e in _[t.id])if(_[t.id][e]!==t[e]){this.trigger("warn",{message:"EXT-X-DATERANGE tags with the same ID in a playlist must have the same attributes and same attribute values"});break}}else _[t.id]=t},"independent-segments"(){this.manifest.independentSegments=!0}}[u.tagType]||s).call(e)},uri(){r.uri=u.uri,t.push(r),this.manifest.targetDuration&&!("duration"in r)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),r.duration=this.manifest.targetDuration),a&&(r.key=a),r.timeline=l,i&&(r.map=i),c=0,r={}},comment(){},custom(){u.segment?(r.custom=r.custom||{},r.custom[u.customType]=u.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[u.customType]=u.data)}})[u.type].call(e)}))}warnOnMissingAttributes_(e,t,i){const a=[];i.forEach((function(e){t.hasOwnProperty(e)||a.push(e)})),a.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${a.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push("\n"),this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}const z={apk:"application/vnd.android.package-archive","3gp":"video/3gpp",ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm",class:"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",flv:"video/x-flv",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",gz:"application/x-gzip",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m3u8:"application/x-mpegURL",m4a:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4s:"video/mp4",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",ogv:"video/ogv",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",ts:"video/MP2T",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbxml:"application/vnd.wap.wbxml",webm:"video/webm",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wmv:"video/x-ms-wmv",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"},F=e=>z[e]??"application/octet-stream",B=(e=[],t="0",i="0",a=!1)=>{let r=[];for(const n in e)if(["symbols","hashtags","urls","user_mentions"].includes(n))for(const s of e[n])r.push(K(n,s,t,i,a));return r.sort(((e,t)=>e.indices_start-t.indices_start))},W=(e="",t="",i="",a=[])=>{let r="",n=0;e="string"==typeof e?[...e]:[];const s=a.length;for(const o in a){const l=a[o];let d="";switch(l.type){case"hashtag":d+=`&lt;a href="#/hashtag/${l.text}" id="hashtag">#${l.text}&lt;/a>`;break;case"symbol":d+=`&lt;a href="#/hashtag/${l.text}" id="symbol">#${l.text}&lt;/a>`;break;case"user_mention":d+=`&lt;a href="${l.expanded_url}" id="user_mention" target="_blank">${l.text}&lt;/a>`;break;case"url":t===l.url&&o===s-1?t=l.expanded_url:l.url!==i&&(d+=`&lt;a href="${l.expanded_url}" id="url" target="_blank">${l.text}&lt;/a>`)}r+=e.slice(n,l.indices_start).join("")+d,n=l.indices_end}return r+=e.slice(n).join(""),{text:r.replaceAll(/ https:\/\/t.co\/[\w]+/g,"").replaceAll("\n","&lt;br />"),cardUrl:t}},Y=(t={},i="0",a="0",r=!1,n=!1,s="tweets",o="")=>{if(!t)return[];let l=[];const d=e("tweet_media_path",t)||[];for(const e in d)l=l.concat(Q(d[e],i,a,r,s,o,n));return l},H=(t={},i={},a="0",r="0",n=!0,s=!1,o=!1)=>{if(t.tombstone)return console.log("tmv3: Quote deleted"),{inSqlQuote:{tweet_id:"",uid:"",name:"",display_name:"",full_text:"",full_text_origin:"",time:0,media:0,video:0,deleted:!0},quoteMedia:[]};let l={tweet_id:e("tweet_id",t),uid:e("tweet_uid",t),name:"",display_name:"",full_text:e("tweet_full_text",t),full_text_origin:e("tweet_full_text",t),time:Math.floor(Date.parse(e("tweet_created_at",t))/1e3),media:0,video:0};n?(l.display_name=e("graphql_user_result",t)?.legacy?.name??"",l.name=e("graphql_user_result",t)?.legacy?.screen_name??"",l.name||l.display_name||console.log(`tmv2: warning, no display name [${l.tweet_id}]`)):(l.display_name=i[t.user_id_str]?.name??"",l.name=i[t.user_id_str]?.screen_name??"");const d=e("tweet_entities",t)||[];for(const e of d.urls??[])l.full_text=l.full_text.replaceAll(e.url,`&lt;a href="${e.expanded_url}" id="quote_url" target="_blank" style="color: black">${e.display_url}&lt;/a>`);l.full_text=l.full_text.replaceAll(/ https:\/\/t.co\/[\w]+/g,"").replaceAll("\n","\n&lt;br />");let c=[];return d.media&&(l.media=1,c=Y(t,a,r,s,o,"quote_status"),c.some((e=>!e.origin_type.endsWith("photo")))&&(l.video=1)),{inSqlQuote:l,quoteMedia:c}},V=(t={},i="0",a="0",r="",n=!0,s=!1,o=!1)=>{let l={data:{},media:[],supported:!1,card_name:"",card_type:"",message:"Success",poll:0,app_data:[]};if(l.card_name=e("tweet_card_name",t),l.card_type=l.card_name.replaceAll(/[\d]+:(.*)/g,"$1"),A.includes(l.card_type)){const e=J(t,i,a,s,r,l.card_type,n,o);l.data=e.data,l.app_data=e.app_data??[],l.supported=!0,e.data.poll&&(e.data.polls??1)&&(l.poll=1),e.media.length&&(l.media=l.media.concat(e.media))}else l.message=`\n #new_card #${l.card_name} \nid: $tweet_id\nhttps://twitter.com/i/status/$tweet_id\n${JSON.stringify(t)}`;return l},K=(e,t={},i=0,a=0,r=!1)=>{let n={text:"",expanded_url:"",url:"",hidden:r,uid:i,tweet_id:a,indices_start:t.indices[0],indices_end:t.indices[1],length:t.indices[1]-t.indices[0],type:e.slice(0,-1)};switch(e){case"symbols":case"hashtags":n.text=t.text;break;case"urls":n.text=t.display_url,n.expanded_url=t.expanded_url,n.url=t.url;break;case"user_mentions":n.text=`@${t.screen_name}`,n.expanded_url=`https://twitter.com/${t.screen_name}`}return n},Q=(e={},t="0",i="0",a=!1,r="tweets",n="",s=!1)=>{let o;const l=[];let d={cover:e.media_url_https,url:"",filename:"",extension:"",basename:"",bitrate:0,hidden:a,source:r,title:e?.additional_media_info?.title??"",description:e?.additional_media_info?.description??e?.ext_alt_text??"",uid:t,tweet_id:i,origin_type:n||(e?.type??""),origin_info_width:e.original_info.width,origin_info_height:e.original_info.height,media_key:e.media_key??""};switch(""!==d.description&&""===d.title&&e?.ext_alt_text&&(d.title="ALT"),s&&e?.sensitive_media_warning&&(d.sensitive_media_warning=e.sensitive_media_warning),e.type){case"video":case"animated_gif":const r=e.video_info.variants.filter((e=>void 0!==e.bitrate)).sort(((e,t)=>t.bitrate-e.bitrate))[0];d.bitrate=r.bitrate,d.url=r.url.replaceAll(/\?.*/gm,""),d.content_type=r.content_type,o=T(d.url),d.filename=o.filename,d.basename=o.basename,d.extension=o.extension,l.push(d);let n={tweet_id:i,uid:t,cover:e.media_url_https,url:e.media_url_https,bitrate:0,origin_type:"photo",hidden:a,media_key:e.media_key??"",source:"cover",title:"",description:"",origin_info_width:e.original_info.width,origin_info_height:e.original_info.height};o=T(e.media_url_https),n.filename=o.filename,n.basename=o.basename,n.extension=o.extension,n.content_type=F(n.extension),l.push(n);break;case"photo":d.url=e.media_url_https,o=T(e.media_url_https),d.filename=o.filename,d.basename=o.basename,d.extension=o.extension,d.content_type=F(o.extension),l.push(d)}return l},J=(e={},t="0",i="0",a=!1,r="",n="",s=!0,o=!1)=>{let l={data:{type:n,secondly_type:"",title:"",description:"",vanity_url:"",url:r,media:0,unified_card_app:0,poll:0,uid:t,tweet_id:i,hidden:a,polls:[]},media:[],app_data:[]},d={title:"title",description:"description",vanity_url:"vanity_url",cover:"thumbnail_image_large",origin:"thumbnail_image_original"};if(s&&(e.binding_values=Object.fromEntries(e.binding_values.map((e=>[e.key,e.value])))),n.startsWith("poll")){l.data.poll=1;const r=Math.floor(Date.parse(e.binding_values.end_datetime_utc.string_value)/1e3);for(let n=1;n&lt;=4&&e.binding_values[`choice${n}_label`];n++)l.data.polls.push({uid:t,tweet_id:i,hidden:a,choice_label:e.binding_values[`choice${n}_label`].string_value,count:Number(e.binding_values[`choice${n}_count`].string_value),poll_order:n,end_datetime:r});if(n.endsWith("image")){l.data.media=1,l.media={media_key:"",uid:t,tweet_id:i,hidden:a,origin_type:`${n}_card_photo`,bitrate:0,title:"",description:"",cover:e.binding_values.image_large.image_value.url,url:e.binding_values.image_original.image_value.url,origin_info_width:e.binding_values.image_original.image_value.width,origin_info_height:e.binding_values.image_original.image_value.height,source:"cards"};const r=T(l.media.url);l.filename=r.filename,l.basename=r.basename,l.extension=r.extension,l.content_type=F(r.extension)}}else{if("unified_card"===n){const r=JSON.parse(e.binding_values.unified_card.string_value);switch(l.data.media=1,l.data.secondly_type=r.type??r?.component_objects?.details_1?.type??r?.component_objects?.media_with_details_horizontal_1?.type??"",l.data.secondly_type){case"image_website":case"video_website":case"image_carousel_website":case"video_carousel_website":l.data.description=r.component_objects.details_1.data.title.content,l.data.vanity_url=r.component_objects.details_1.data.subtitle.content,l.data.url=r.destination_objects[r.component_objects.details_1.data.destination].data.url_data.url;break;case"image_app":case"video_app":case"image_carousel_app":case"video_carousel_app":case"mixed_media_single_dest_carousel_app":l.data.unified_card_app=1,l.data.title=r.app_store_data.app_1[0].title.content,l.data.description=r.app_store_data.app_1[0].category.content,l.data.vanity_url="App Store",l.app_data=r.app_store_data.app_1.map((e=>({tweet_id:i,uid:t,unified_card_type:l.data.secondly_type,type:e.type,appid:e.id,country_code:e.country_code,title:e.title.content,category:e.category.content})));break;case"mixed_media_single_dest_carousel_website":l.data.description=r.component_objects.details_1.data.title.content,l.data.vanity_url=r.component_objects.details_1.data.subtitle.content,l.data.url=r.destination_objects.browser_1.data.url_data.url;break;case"image_multi_dest_carousel_website":case"video_multi_dest_carousel_website":case"mixed_media_multi_dest_carousel_website":case"image_collection_website":let e=0;for(const t of r.layout.data.slides){const i=t.filter((e=>e.startsWith("details_")))[0]||"";i&&(l.data.description+=(e?"\t":"")+r.component_objects[i].data.title.content,l.data.vanity_url+=(e?"\t":"")+r.component_objects[i].data.subtitle.content,l.data.url+=(e?"\t":"")+(r.destination_objects[r.component_objects[i].data.destination].data?.title?.content??r.destination_objects[r.component_objects[i].data.destination].data?.url_data?.url),e++)}break;case"twitter_list_details":l.data.description=r.component_objects.details_1.data.member_count+"\t"+r.component_objects.details_1.data.name.content,l.data.vanity_url=r.users[r.component_objects.details_1.data.user_id].name+"\t"+r.users[r.component_objects.details_1.data.user_id.screen_name]+"\t"+Number(r.users[r.component_objects.details_1.data.user_id.verified]),l.data.url=r.destination_objects[r.component_objects.details_1.data.destination].data.url_data.url;break;case"media_with_details_horizontal":l.data.description=r.component_objects.media_with_details_horizontal_1.data.topic_detail.title.content,l.data.vanity_url=r.destination_objects.browser_1.data.url_data.vanity,l.data.url=r.destination_objects.browser_1.data.url_data.url;break;case"twitter_article":l.data.description=r.component_objects.text.data.title.content,l.data.vanity_url=r.component_objects.text.data.subtitle.content,l.data.url=r.destination_objects.article.data.url_data.url}if(r.media_entities){l.data.media=1;let e=[];if("twitter_article"===l.data.secondly_type){l.media.push({media_key:"",uid:t,tweet_id:i,hidden:a,origin_type:`${n}_${l.data.secondly_type}_card_${r.media_entities.cover_image.type}`,bitrate:0,title:"",description:"",cover:r.media_entities.cover_image.media_url_https,url:r.media_entities.cover_image.media_url_https,origin_info_width:r.media_entities.cover_image.original_info.width,origin_info_height:r.media_entities.cover_image.original_info.height,source:"cards"});let e=T(l.media[0].url);l.media[0].filename=e.filename,l.media[0].basename=e.basename,l.media[0].extension=e.extension,l.media[0].content_type=F(e.extension)}else e=r?.layout?.data?.slides?r.layout.data.slides.map((e=>{const t=e.filter((e=>e.startsWith("media_")))[0]||"";return t?r.component_objects[t].data:null})).filter((e=>e)):r?.component_objects?.swipeable_media_1?.data?.media_list??[r?.component_objects?.media_1?.data??{id:"media_1"}],l.media=e.map((e=>Q(r.media_entities[e.id],t,i,a,"cards",`${n}_${l.data.secondly_type}_card_${r.media_entities[e.id].type}`,o))).flat()}return l}switch(n){case"periscope_broadcast":l.data.url=e.binding_values.url.string_value;case"summary_large_image":d.cover="summary_photo_image_large",d.origin="summary_photo_image_original";break;case"audio":d.vanity_url="partner";case"promo_video_website":case"player":case"appplayer":d.cover="player_image_large",d.origin="player_image_original";break;case"broadcast":d.cover="broadcast_thumbnail_large",d.origin="broadcast_thumbnail_original",d.title="broadcast_title",l.data.url=e.binding_values.broadcast_url.string_value;break;case"promo_website":d.cover="promo_image_large",d.origin="promo_image_original",l.data.url=e?.binding_values?.website_url?.string_value;break;case"promo_image_convo":d.title="thank_you_text",d.vanity_url="thank_you_vanity_url",d.cover="promo_image_large",d.origin="promo_image_original",l.data.url=e?.binding_values?.thank_you_url?.string_value??"";break;case"promo_video_convo":d.title="thank_you_text",d.vanity_url="thank_you_vanity_url",d.cover="player_image_large",d.origin="player_image_large",l.data.url=e?.binding_values?.thank_you_url?.string_value??"";break;case"promo_image_app":d.cover="promo_image_large",d.origin="promo_image_original";break;case"direct_store_link_app":d.vanity_url="card_url";case"app":d.cover="thumbnail_large",d.origin="thumbnail_original";break;case"live_event":d.title="event_title",d.description="event_subtitle",d.cover="event_thumbnail_large",d.origin="event_thumbnail_original";break;case"moment":d.cover="photo_image",d.origin="photo_image",l.data.url=e.binding_values.url.string_value;break;case"audiospace":l.data.url=e.binding_values.id.string_value}l.data.title=e.binding_values[d.title]?.string_value??"",l.data.description=(e.binding_values[d.description]?.string_value??"")+(("app"===n||"appplayer"===n)&&e?.binding_values?.app_star_rating?.string_value&&e?.binding_values?.app_num_ratings?.string_value?`\n${e.binding_values.app_star_rating.string_value}/5.0 stars - ${e.binding_values.app_num_ratings.string_value} ratings`:""),l.data.vanity_url=(e.binding_values[d.vanity_url]?.string_value??"")+(("promo_image_app"===n||"appplayer"===n)&&e.binding_values.site?.user_value?.id_str&&(s&&e.user_refs||!s&&e?.users[e.binding_values.site.user_value.id_str])?s?e.user_refs[0].legacy.name:e.users[e.binding_values.site.user_value.id_str].name:"")}if(e.binding_values[d.origin]){l.data.media=1,l.media.push({media_key:"",uid:t,tweet_id:i,hidden:a,origin_type:`${n}_card_photo`,bitrate:0,title:"",description:"",cover:e.binding_values[d.cover].image_value.url,url:e.binding_values[d.origin].image_value.url,origin_info_width:e.binding_values[d.origin].image_value.width,origin_info_height:e.binding_values[d.origin].image_value.height,source:"cards"});let r=T(l.media[0].url);l.media[0].filename=r.filename,l.media[0].basename=r.basename,l.media[0].extension=r.extension,l.media[0].content_type=F(r.extension)}return l},Z=(e={})=>{let t={id:"",avatar:"",name:"",display_name:"",state:"Invalid",start:"0",end:"0",media_key:"",title:"",total:0,verified:!1,admins:[],listeners:[],speakers:[],is_available_for_replay:!1};if(!e.data||!e.data.audioSpace.metadata)return t;t.id=e.data.audioSpace.metadata.rest_id,t.avatar=e.data.audioSpace.metadata.creator_results.result.legacy.profile_image_url_https,t.display_name=e.data.audioSpace.metadata.creator_results.result.legacy.name,t.name=e.data.audioSpace.metadata.creator_results.result.legacy.screen_name,t.verified=e.data.audioSpace.metadata.creator_results.result.legacy?.verified??!1,t.state=e.data.audioSpace.metadata.state,t.start=String(e.data.audioSpace.metadata?.started_at??e.data.audioSpace.metadata?.scheduled_start??0),t.end=String(e.data.audioSpace.metadata?.ended_at??0),t.media_key=e.data.audioSpace.metadata.media_key??"",t.is_available_for_replay=e.data.audioSpace.metadata.is_available_for_replay??e.data.audioSpace.metadata.is_space_available_for_replay??!1,t.title=e.data.audioSpace.metadata?.title??"",t.total=(e.data.audioSpace.metadata?.total_live_listeners??0)+(e.data.audioSpace.metadata?.total_replay_watched??0);const i=e=>{let t={uid:0,uid_str:"0",name:"",display_name:"",avatar:"",start:"0"};return t.uid=e.user_results.rest_id,t.uid_str=e.user_results.rest_id,t.name=e.twitter_screen_name,t.display_name=e.display_name,t.avatar=e.avatar_url,t.start=String(e.start),t};return t.admins=(e.data.audioSpace?.participants?.admins??[]).map((e=>i(e))),t.speakers=(e.data.audioSpace?.participants?.speakers??[]).map((e=>i(e))),t.listeners=(e.data.audioSpace?.participants?.listeners??[]).map((e=>i(e))),t},ee=(e={})=>{let t={id:"",avatar:"",name:"",display_name:"",state:"invalid",start:"0",end:"0",media_key:"",title:"",total:0,is_available_for_replay:!1};return e.broadcasts&&0!==Object.keys(e.broadcasts).length?(e=e.broadcasts[Object.keys(e.broadcasts)[0]],t.id=e.id,t.avatar=e.profile_image_url,t.display_name=e.user_display_name,t.name=e.username,t.state=(e.state||"").toLocaleLowerCase(),t.start=String(e.start_ms??e.scheduled_start_ms??0),t.end=String(e.end_ms??e.scheduled_end_ms??0),t.media_key=e.media_key??"",t.is_available_for_replay=e.available_for_replay??!1,t.title=e.status??"",t.total=Number(e.total_watched??0)+Number(e.total_watching??0),t):t},te=(t={},i={},a=[],r="",n=!0,s=!1)=>{let o=((t={},i={},a=[],r={},n=!0,s=!1,o=!1)=>{const l=!!Object.keys(r).length;let d,c={},_="",u="",p={retweet_from:"",retweet_from_name:"",origin_tweet_id:"0",tweet_id:"0",uid:"0",conversation_id_str:0,name:"",display_name:"",full_text:"",full_text_origin:"",time:0,media:0,video:0,card:"",poll:0,quote_status:0,source:"",hidden:s},m={},g={},h=[],w={},b={},f=[],y=[],v=[],x=[],T={},A={},k={card_name:"",supported:!1,message:""},O={},I=[],R={favorite_count:0,retweet_count:0,quote_count:0,view_count:0,reply_count:0},D=!1,q=!1,j=!1,N=[0,0],P={text:"",imgDescription:"",discoveryQueryText:""};n&&(t=e("tweet_content",t)),p.tweet_id=e("tweet_id",t),p.origin_tweet_id=p.tweet_id,p.uid=e("tweet_uid",t),p.conversation_id_str=e("tweet_conversation_id_str",t)||p.tweet_id,p.time=Math.floor(Date.parse(e("tweet_created_at",t))/1e3),p.source=(e("tweet_source",t)||"").replaceAll(/&lt;a[^>]+>(.*)&lt;\/a>/gm,"$1"),l?(p.name=r.name,p.display_name=l.display_name):(c=n?e("graphql_user_result",t)??{}:i[p.uid]??{},Object.keys(c).length&&(c?.legacy?.screen_name||c?.screen_name)&&(m=S(c).GeneralAccountData,m.uid_str=p.uid,m.uid=p.uid,m.description=m.description.replaceAll("\n","&lt;br />"),m.header=m.header.replaceAll(/http:\/\/|https:\/\//gm,""),d=E(m.description),m.description_origin=d.originText,m.description_entities=d.entities,p.name=m.name??"",p.display_name=m.display_name??""));if(e("retweet_rest_id",t))if(q=!0,p.origin_tweet_id=e("retweet_rest_id",t),n)t=e("retweet_graphql_path",t),c=e("graphql_user_result",t),c&&(c?.legacy?.screen_name||c?.screen_name)&&(g=S(c).GeneralAccountData,g.description=g.description.replaceAll("\n","&lt;br />"),g.header=g.header.replaceAll(/http:\/\/|https:\/\//gm,""),g.uid_str=e("tweet_uid",t),g.uid=g.uid_str,d=E(g.description),g.description_origin=d.originText,g.description_entities=d.entities,p.retweet_from=g.display_name??"",p.retweet_from_name=g.name??"");else if(l);else{if(!(t=a.filter((e=>e.id_str===t.retweeted_status_id_str))[0]))return console.log("tmv3: no retweet content"),{error:{code:1003,message:"No retweet content"}};c=i[t.user_id_str],c&&c.screen_name&&(g=S(c).GeneralAccountData,g.description=g.description.replaceAll("\n","&lt;br />"),g.header=g.header.replaceAll(/http:\/\/|https:\/\//gm,""),g.uid_str=t.user_id_str,g.uid=t.user_id_str,d=E(g.description),g.description_origin=d.originText,g.description_entities=d.entities,p.retweet_from=g.display_name??"",p.retweet_from_name=g.name??"")}u=t.card&&!(e("tweet_card_url",t.card)||"").startsWith("card://")?e("tweet_card_url",t.card):"",D=!!(!n&&t.is_quote_status&&a.some((e=>e.id_str===t.quoted_status_id_str))||n&&t?.legacy?.is_quote_status&&(t.quoted_status||t.quoted_status_result)),_=D?e("tweet_quote_url",t):"",p.full_text_origin=e("tweet_full_text",t);const $=e("tweet_entities",t);Object.keys($).some((e=>$[e].length>0))&&(h=B($,p.uid,p.tweet_id,s)),t?.note_tweet?.note_tweet_results?.result?.richtext&&(w={richtext:t.note_tweet.note_tweet_results.result.richtext,text:p.full_text_origin,entities:h});const C=W(p.full_text_origin,u,_,h);if(p.full_text=C.text,u=C.cardUrl,f=Y(t,p.uid,p.tweet_id,s,o),!f.length||"video"!==f[0]?.origin_type&&"animated_gif"!==f[0]?.origin_type||(x=(e("tweet_media_path",t)||[]).filter((e=>e.video_info)).map((e=>e.video_info)),p.video=1),D){p.quote_status=e("quote_tweet_id",t);const r=n?e("quote_graphql_path",t):a.filter((e=>e.id_str===p.quote_status))[0];if(r&&!r.tombstone){const e=H(r,i,p.uid,p.tweet_id,n,s,o);b=e.inSqlQuote,y=e.quoteMedia,f=f.concat(y)}else r.tombstone&&console.log(`tmv3: Quote deleted (from #${p.tweet_id})`)}const M=e("tweet_card_path",t);if(M){const e=V(M,p.uid,p.tweet_id,u,n,s,o);p.card=e.card_type,p.poll=e.poll,T=e.data,T.polls&&(I=T.polls,delete T.polls,delete T.poll),A=e.app_data,v=e.media,f=f.concat(v),k.card_name=e.card_name,k.supported=e.supported,k.message=e.message}return f.length&&(p.media=1),R.favorite_count=t?.legacy?.favorite_count??t?.favorite_count??0,R.retweet_count=t?.legacy?.retweet_count??t?.retweet_count??0,R.quote_count=t?.legacy?.quote_count??t?.quote_count??0,R.reply_count=t?.legacy?.reply_count??t?.reply_count??0,R.view_count=t?.views?.count??t?.views_count??0,j=(t?.legacy?.lang??t?.lang??"").includes(["ar","fa","iw","ur"]),N=t?.legacy?.display_text_range??t?.display_text_range??[0,0],n&&(t?.vibe?.text||t?.vibe?.imgDescription)&&(P={text:t?.vibe?.text??"",imgDescription:t?.vibe?.imgDescription??"",discoveryQueryText:t?.vibe?.discoveryQueryText??""}),(t?.legacy?.place||t?.place)&&(O=t?.legacy?.place||t?.place||{}),{GeneralTweetData:p,userInfo:m,retweetUserInfo:g,tags:h,richtext:w,quote:b,media:f,quoteMedia:y,cardMedia:v,video:x,card:T,cardApp:A,cardMessage:k,place:O,polls:I,interactiveData:R,isQuote:D,isRetweet:q,isRtl:j,displayTextRange:N,vibe:P}})(t,i,a,{},n,!1,!0);return o.GeneralTweetData.favorite_count=o.interactiveData.favorite_count,o.GeneralTweetData.retweet_count=o.interactiveData.retweet_count,o.GeneralTweetData.quote_count=o.interactiveData.quote_count,o.GeneralTweetData.reply_count=o.interactiveData.reply_count,o.GeneralTweetData.view_count=o.interactiveData.view_count,o.GeneralTweetData.rtl=o.isRtl,o.GeneralTweetData.display_text_range=o.displayTextRange,(o.vibe?.text||o.vibe?.imgDescription)&&(o.GeneralTweetData.vibe=o.vibe),o.place?.id&&(o.GeneralTweetData.place=o.place),o.richtext?.richtext&&(o.GeneralTweetData.richtext=o.richtext.richtext),s||""===r||r.toLocaleLowerCase()===o.GeneralTweetData.name.toLocaleLowerCase()?{code:200,userInfo:o.userInfo,retweetUserInfo:o.retweetUserInfo,data:ie(o.GeneralTweetData,!0,o.tags,o.polls,o.card,o.cardApp,o.quote,o.media)}:{code:0,data:{}}},ie=(e={},t=!1,i=[],a=[],r={},n={},s={},o=[])=>{if(e.type="tweet",t&&(e.entities=i),e.pollObject={},e.poll&&a.length&&(e.pollObject=a.filter((t=>t.tweet_id===e.tweet_id)).map((e=>(delete e.tweet_id,e.checked=!!e.checked,e)))),e.cardObject={},e.card&&Object.keys(r).length&&(e.cardObject=r,e.cardObject.unified_card_app&&(e.cardObject.unified_card_app=!!e.cardObject.unified_card_app,e.cardObject.app=n)),e.quoteObject={},e.quote_status&&Object.keys(s).length){e.quoteObject=s,e.quoteObject.id_str=e.quoteObject.tweet_id,e.quoteObject.tweet_id=e.quoteObject.tweet_id,e.quote_status_str=e.quoteObject.id_str;const{originText:t,entities:i}=E(e.quoteObject.full_text,"quote");e.quoteObject.full_text=t,e.quoteObject.entities=i}let l="";if(e.mediaObject=[],e.media||e.cardObject.media||e.quoteObject.media){for(const t of o)t.tweet_id!==e.tweet_id&&t.tweet_id!==e.quote_status||(t.cover=t.cover.replaceAll(/http(s|):\/\//gm,""),t.url=t.url.replaceAll(/http(s|):\/\//gm,""),t.title||delete t.title,t.description||delete t.description,"tweets"===t.source&&t.tweet_id===e.tweet_id?(l+=`&lt;img src="https://pbs.twimg.com/media/${t.filename}?format=${t.extension}&name=orig">`,e.mediaObject.push(t)):"cards"!==t.source&&"quote_status"!==t.source||e.mediaObject.push(t));e.mediaObject=[...new Set(e.mediaObject)]}return e.tweet_id_str=String(e.tweet_id),e.uid_str=String(e.uid),e},ae=(t,i=!1,a="",r=!1)=>{const n=((t={},i=!0)=>{let a={errors:{code:0,message:"Success"},contents:[],contentLength:0,users:{},cursor:{top:"",bottom:""},tweetRange:{max:"0",min:"0"}};if(t.errors&&!i?(a.errors.code=t[0].code,a.errors.message=t[0].message):!e("tweets_instructions",t)&&i&&(a.errors.code=1002,a.errors.message=t?.data?.user?.result?.__typename??"Nothing here"),0===a.errors.code){const r=e("tweets_instructions",t);let n=[];if(i){for(const t of r)if("TimelineAddEntries"===t.type){n=t.entries.filter((e=>e.entryId.startsWith("cursor-"))),a.contents=a.contents.concat(t.entries).filter((e=>e.entryId.startsWith("tweet-")||e.entryId.startsWith("conversationthread-")||e.entryId.startsWith("profile-conversation"))),a.tweetRange.max=e("tweet_id",a.contents[0])||0,a.tweetRange.min=e("tweet_id",a.contents.slice(-1)[0])||0,a.users=Object.fromEntries(t.entries.filter((e=>e.entryId.startsWith("tweet-")||e.entryId.startsWith("conversationthread-")||e.entryId.startsWith("profile-conversation"))).map((t=>{const i=e("graphql_user_result",e("tweet_content",t));if(!i)return[[null,{id_str:null}]];const a=[[i.rest_id,i]],r=e("graphql_user_result",e("retweet_graphql_path",e("tweet_content",t))),n=e("graphql_user_result",e("quote_graphql_path",e("tweet_content",t)));return r&&a.push([r.rest_id,r]),n&&a.push([n.rest_id,n]),a})).flat().filter((e=>e[0])));for(const e of t.entries.filter((e=>e.entryId.startsWith("user-"))))a.users[e.content.itemContent.user_results.result.rest_id]=e.content.itemContent.user_results.result}else"TimelinePinEntry"===t.type?a.contents.push(t.entry):"TimelineReplaceEntry"===t.type&&t.entry_id_to_replace.startsWith("cursor-")&&n.push(t.entry);a.contentLength=a.contents.length;for(let e of n)e?.entry?.content?e=e.entry:e?.content?.itemContent?.value&&(e={content:{entryType:e.content.itemContent.itemType,cursorType:e.content.itemContent.cursorType,value:e.content.itemContent.value}}),"TimelineTimelineCursor"===e.content.entryType&&("Top"===e.content.cursorType?a.cursor.top=e.content.value:"Bottom"===e.content.cursorType&&(a.cursor.bottom=e.content.value))}else{a.users=t.globalObjects.users,a.contents=Object.values(r),a.contentLength=a.contents.length;const e=Object.keys(r).sort(((e,t)=>t-e));a.tweetRange.max=e[0],a.tweetRange.min=e.slice(-1)[0];for(const e of t.timeline.instructions)for(const t of Object.values(e))if(t.entry)t.entryIdToReplace.endsWith("cursor-top")?a.cursor.top=t.entry.content.operation.cursor.value:t.entryIdToReplace.endsWith("cursor-bottom")&&(a.cursor.bottom=t.entry.content.operation.cursor.value);else for(const e of t.entries)e.entryId.endsWith("cursor-top")||"Top"===e?.content?.operation?.cursor?.cursorType?a.cursor.top=e.content.operation.cursor.value:(e.entryId.endsWith("cursor-bottom")||"Bottom"===e?.content?.operation?.cursor?.cursorType)&&(a.cursor.bottom=e.content.operation.cursor.value)}}return a})(t.data,r);if(0!==n.errors.code)return{tweetsInfo:n,tweetsContent:[]};let s=!0,o=n.contents.map((e=>{if(!e)return!1;if(["TimelineTimelineItem"].includes(e?.content?.entryType)){let t=te(e,{},[],"",r,!1);return!(200!==t.code||!Object.keys(t.data).length)&&(t.data.user_info=t.userInfo,t.data.retweet_user_info=t.retweetUserInfo,t.data)}if(["TimelineTimelineModule","VerticalConversation"].includes(e?.content?.displayType))return"TimelineTimelineModule"===e?.content?.displayType&&(s=!1),e.content.items.map((e=>{let t=te(e,n.users,n.contents,a,r,i);return!(200!==t.code||!Object.keys(t.data).length)&&(t.data.user_info=t.userInfo,t.data.retweet_user_info=t.retweetUserInfo,t.data)}));{let t=te(e,n.users,n.contents,a,r,i);if(200===t.code&&Object.keys(t.data).length)return t.data.user_info=t.userInfo,t.data.retweet_user_info=t.retweetUserInfo,t.data}return!1})).flat().filter((e=>e?.tweet_id));return s&&!i||(o=o.reverse()),{tweetsInfo:n,tweetsContent:o}};let re=window.name,ne=window.timelineFirst||!1,se=Date.now(),oe={time:{start:se,end:0},tweet_id:{max:"0",min:"0"}},le={},de={},ce=!1;window.UserData?.account_info?.name!==re&&(window.UserData={account_info:null,account_list:{},tweets:{},type:"lite"},ce=!0);let _e=window.UserData,ue=_e.account_info?.uid||null;if(window.guest_token=new class{#e={};heartBeat;errorCount=10;constructor(){}async updateGuestToken(e=0){const t=Date.now();if((!this.#e.nextActiveTime||this.#e.nextActiveTime&&this.#e.nextActiveTime&lt;t)&&(0===Object.keys(this.#e).length||Object.values(this.#e.rate_limit).some((e=>e&lt;=0))||this.#e.expire&lt;t||t-this.heartBeat>17e5)){console.log(`[${new Date}]: #GuestToken Update guest token #${e}`);do{this.#e=await g(e),this.errorCount--,this.#e.success||console.error(`[${new Date}]: #GuestToken Unable to get guest token, remain ${this.errorCount}`)}while(!this.#e.success&&this.errorCount>0);!this.#e.success&&this.errorCount&lt;=0?(this.#e.nextActiveTime=t+186e4,console.error(`[${new Date}]: #GuestToken Force delay, next active date is --\x3e${this.#e.nextActiveTime}&lt;--`)):(this.heartBeat=t,this.errorCount=10)}return this}updateRateLimit(e="",t=1){return void 0!==this.#e.rate_limit[e]&&(this.#e.rate_limit[e]-=t,this.heartBeat=Date.now()),this}getRateLimit(e=""){return void 0!==this.#e.rate_limit[e]?this.#e.rate_limit[e]:0}preCheck(e="",t=1){return void 0!==this.#e.rate_limit[e]&&this.#e.rate_limit[e]-t>0}get token(){return this.#e}},await window.guest_token.updateGuestToken(1),window.guest_token.token.nextActiveTime&&(await(pe=window.guest_token.token.nextActiveTime-Date.now(),new Promise((e=>{setTimeout(e,pe)}))),await window.guest_token.updateGuestToken(1),!window.guest_token.token.success))throw window.guest_token;var pe;!ce&&Object.values(window.cursor||{}).some((e=>e.cursor))||(window.cursor={tweets:{maxId:"",tmpId:"",cursor:""},broadcast:{maxId:"",tmpId:"",cursor:""},space:{maxId:"",tmpId:"",cursor:""}});let me=window.cursor;if(""===me.tweets.cursor?console.log("archiver: new account"):"complete"===me.tweets.cursor&&(me.tweets.cursor="",me.tweets.maxId&&0!==me.tweets.maxId&&(me.tweets.tmpId=me.tweets.maxId,me.tweets.maxId="")),console.log("archiver: tweets..."),me.tweets.tmpId&&ue||(console.log("archiver: new task is unable to use timeline api"),ne=!1),"complete"!==me.tweets.cursor){let t=[`from:${re}`,"include:replies","include:nativeretweets","include:retweets","include:quote",`since_id:${me.tweets.tmpId?me.tweets.tmpId:0}`].join(" ");console.log(`archiver: query string --\x3e${t}&lt;--`);do{if(await window.guest_token.updateGuestToken(1),window.guest_token.token.nextActiveTime){console.error(`[${new Date}]: #Crawler #GuestToken #429 Wait until ${window.guest_token.token.nextActiveTime}`);break}let i=null;try{i=await w({queryString:ne?ue:t,cursor:ne?"":me.tweets.cursor||"",guest_token:window.guest_token.token,count:999,online:!0,graphqlMode:ne,searchMode:!ne,withReply:!0,cookie:Object.fromEntries(document.cookie.split("; ").map((e=>e.split("="))).filter((e=>e.length>=2)))}),window.guest_token.updateRateLimit("Search")}catch(e){console.log("archiver: first retry...");try{i=await w({queryString:ne?ue:t,cursor:ne?"":me.tweets.cursor||"",guest_token:window.guest_token.token,count:999,online:!0,graphqlMode:ne,searchMode:!ne,withReply:!0}),window.guest_token.updateRateLimit("Search")}catch(e){throw console.log("archiver: retry failed..."),e}}if(null===i)throw"archiver: empty response";let a=ae(i,!1,"",!0);if(0!==a.tweetsInfo.errors.code){console.log(`archiver: error #${a.tweetsInfo.errors.code} , ${a.tweetsInfo.errors.message}`);continue}if(console.log(`archiver: cursor --\x3e${a.tweetsInfo.cursor?.bottom||"end"}&lt;-- (${a.tweetsInfo.contentLength})`),null===ue)try{if(ue=Object.values(a.tweetsInfo.users).filter((e=>e.legacy.screen_name.toLocaleLowerCase()===re.toLocaleLowerCase()))[0]?.rest_id||null,!ue)throw"archiver: no such account!!!"}catch(e){throw e}let r=0;try{a.tweetsInfo.contents.forEach((t=>{let i=e("tweet_id",t);le[i]||(le[i]=t)})),Object.keys(a.tweetsInfo.users).forEach((e=>{de[e]||(de[e]=a.tweetsInfo.users[e])}));for(let e of a.tweetsContent)null===_e.account_info&&(_e.account_info=e.user_info),_e.account_list[e.user_info.uid_str]||(_e.account_list[e.user_info.uid_str]=e.user_info),e.retweet_user_info.uid_str&&!_e.account_list[e.retweet_user_info.uid_str]&&(_e.account_list[e.retweet_user_info.uid_str]=e.retweet_user_info),_e.tweets[e.tweet_id]=e,console.log(`archiver: #${++r} Success -> ${e.tweet_id}`);_e.tweets=Object.fromEntries(Object.entries(_e.tweets).sort(((e,t)=>t[1].time>e[1].time))),ne||(me.tweets.cursor=a.tweetsInfo.contents.length&&a.tweetsInfo.cursor?.bottom||"",me.tweets.maxId&&"0"!==me.tweets.maxId||(me.tweets.maxId=a.tweetsInfo.tweetRange.max,oe.tweet_id.max=a.tweetsInfo.tweetRange.max),oe.tweet_id.min=a.tweetsInfo.tweetRange.min),oe.time.end=Date.now()}catch(e){throw e}}while(me.tweets.cursor&&!ne);me.tweets.cursor="complete",console.log(`archiver: tweets complete, cost ${new Date-se} ms`)}let ge=[],he=0,we=Object.values(_e.tweets).filter((e=>e.polls&&!e.polls[0].count));for(console.log(`archiver: polls... (${we.length})`);he&lt;we.length;he++){const t=se/1e3>we[he].polls[0].end_datetime,i=le[we[he].tweet_id];if(t&&i){let t=e("tweet_card_path",le[we[he].tweet_id]);if(t&&String(e("tweet_card_name",t)).startsWith("poll")){let e=Object.fromEntries(Object.keys(t.binding_values).map((e=>[e,t.binding_values[e]])));for(let t=1;t&lt;=4&&e["choice"+t+"_count"];t++)we[he].polls[t-1].count=e["choice"+t+"_count"].string_value,console.log(`${we[he].tweet_id}: #${t} > ${we[he].polls[t-1].count}`)}else ge.push(we[he].tweet_id),console.log(`archiver: NO POLLS CONTENT (${we[he].tweet_id}) #errorpoll`)}else{let e=await x({tweet_id:we[he].tweet_id});if(200!==e.code)ge.push(we[he].tweet_id),console.log(`archiver: ${e.message} (${we[he].tweet_id}) #errorpoll`);else for(let t in e.data)we[he].polls[t].count=e.data[t],console.log(`${we[he].tweet_id}: #${Number(t)+1} > ${we[he].polls[t].count}`)}console.log(`archiver: ${he+1} / ${we.length}`)}we.forEach((e=>{_e.tweets[e.tweet_id]=e}));let be=Object.values(_e.tweets).filter((e=>("broadcast"===e.cardObject?.type||"periscope_broadcast"===e.cardObject?.type)&&!e.broadcastObject)).map((e=>e.cardObject)),fe=[],ye={};if(be.length&lt;=0)console.log("archiver: no broadcast (0)");else for(;be.length>0;){console.log(`archiver: broadcast (${be.length})`);let e=be.splice(0,100);await window.guest_token.updateGuestToken(1);let t=await y({id:e.map((e=>e.url.replaceAll(/.*\/([^\/\?#]+)(?:$|\?.*|#.*)/gm,"$1"))),guest_token:window.guest_token.token});window.guest_token.updateRateLimit("BroadCast",100);for(let i in t){let a=t[i];if("fulfilled"===a.status){let t=ee(a.value.data),r={data:null};if(t.is_available_for_replay||Number(t.start)&lt;=Date.now()&&"0"===t.end)try{if(r=await v({media_key:t.media_key}),r.data?.source?.noRedirectPlaybackUrl){let e=r.data?.source?.noRedirectPlaybackUrl;try{let t=new URL(e),i=t.origin;if(t.pathname.split("/").pop().includes("master_dynamic_")){let t=(await p.get(e)).data,a=new G;a.push(t),a.end(),e=i+a.manifest.playlists.sort(((e,t)=>t.attributes.BANDWIDTH-e.attributes.BANDWIDTH))[0].uri}}catch(t){console.error(t),console.log(`archiver: Unable to parse playlists from '${e}', fallback.`)}t.playback=e.replaceAll("?type=replay","").replaceAll("?type=live","")}}catch(e){console.error(e)}console.log(`archiver: broadcast --\x3e${t.id}&lt;--`),ye[t.id]={info:a.value.data,source:r?.data},_e.tweets[e[i].tweet_id].broadcastObject=t}else fe.push(e[i]),console.log(`archiver: broadcast error --\x3e${e[i].tweet_id}&lt;--`)}}let ve=Object.values(_e.tweets).filter((e=>"audiospace"===e.cardObject?.type&&!e.audiospaceObject)).map((e=>e.cardObject)),xe=[],Te={};if(ve.length&lt;=0)console.log("archiver: no audiospace (0)");else for(;ve.length>0;){console.log(`archiver: audiospace (${ve.length})`);let e=ve.splice(0,100);await window.guest_token.updateGuestToken(1);let t=await f({id:e.map((e=>e.url)),guest_token:window.guest_token.token});window.guest_token.updateRateLimit("AudioSpaceById",100);for(let i in t){let a=t[i];if("fulfilled"===a.status){let t=Z(a.value.data),r={data:null};if(t.is_available_for_replay||Number(t.start)&lt;=Date.now()&&"0"===t.end)try{r=await v({media_key:t.media_key}),r.data?.source?.noRedirectPlaybackUrl&&(t.playback=r.data?.source?.noRedirectPlaybackUrl.replaceAll("?type=replay","").replaceAll("?type=live",""))}catch(e){console.error(e)}console.log(`archiver: audiospace --\x3e${t.id}&lt;--`),Te[t.id]={info:a.value.data,source:r?.data},_e.tweets[e[i].tweet_id].audiospaceObject=t}else xe.push(e[i]),console.log(`archiver: audiospace error --\x3e${e[i].tweet_id}&lt;--`)}}console.log(`archiver: Time cost ${new Date-se} ms`),window.open(URL.createObjectURL(new Blob([JSON.stringify(window.UserData,null,4)],{type:"application/json"})));

</pre></code>
                                </div>
                            </div>
                        </li>
                        <li >Then save content opened in a new tab and named as <code class="font-bold">what_you_like.json</code>.</li>
                        <li >Go to <router-link to="/" class="underline-offset-4 decoration-sky-500 underline">Home</router-link> and upload the file you saved, enjoy it!</li>
                    </ul>
                    <p class="my-3">
                        * Auto build system is not yet ready, so I have to copy-paste script code here manually
                    </p>
                </p>
            </div>
        </div>
    </div>
</template>

<script setup lang="ts">
import {useMainStore} from "~/stores/main";
import SideList from "~/components/SideList.vue";

useHead({
    title: 'About'
})
const store = useMainStore()

definePageMeta({
    layout: "archive-viewer",
})
</script>
